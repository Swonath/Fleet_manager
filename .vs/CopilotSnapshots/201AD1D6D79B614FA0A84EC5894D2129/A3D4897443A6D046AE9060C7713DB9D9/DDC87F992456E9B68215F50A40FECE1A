using System.Windows;
using FLEET_MANAGER.Models;
using FLEET_MANAGER.ViewModels;
using FLEET_MANAGER.Views;

namespace FLEET_MANAGER
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        private DashboardViewModel _dashboardViewModel;
        private VehiculeViewModel _vehiculeViewModel;
        private CarburantViewModel _carburantViewModel;
        private TrajetViewModel _trajetViewModel;

        private VehiculeView _vehiculeView;
        private CarburantView _carburantView;
        private TrajetView _trajetView;

        public MainWindow()
        {
            InitializeComponent();
            
            _dashboardViewModel = new DashboardViewModel();
            _vehiculeViewModel = new VehiculeViewModel();
            _carburantViewModel = new CarburantViewModel();
            _trajetViewModel = new TrajetViewModel();

            _vehiculeView = new VehiculeView { DataContext = _vehiculeViewModel };
            _carburantView = new CarburantView { DataContext = _carburantViewModel };
            _trajetView = new TrajetView { DataContext = _trajetViewModel };
            
            // S'abonner à la notification de mise à jour des véhicules
            _vehiculeViewModel.VéhiculesChangé += OnVéhiculesChangé;
            
            DataContext = _dashboardViewModel;
        }

        private void OnVéhiculesChangé()
        {
            // Recharger les véhicules dans les autres ViewModels
            _carburantViewModel.RéchargerVéhicules();
            _trajetViewModel.RéchargerVéhicules();
        }

        public void InitialiserAvecUtilisateur(Utilisateur utilisateur)
        {
            _dashboardViewModel.InitialiserAvecUtilisateur(utilisateur);
        }

        private void BtnDashboard_Click(object sender, RoutedEventArgs e)
        {
            DataContext = _dashboardViewModel;
            ContentArea.Content = null;
        }

        private void BtnVehicules_Click(object sender, RoutedEventArgs e)
        {
            DataContext = _vehiculeViewModel;
            ContentArea.Content = _vehiculeView;
        }

        private void BtnCarburant_Click(object sender, RoutedEventArgs e)
        {
            DataContext = _carburantViewModel;
            ContentArea.Content = _carburantView;
        }

        private void BtnTrajets_Click(object sender, RoutedEventArgs e)
        {
            DataContext = _trajetViewModel;
            ContentArea.Content = _trajetView;
        }

        private void BtnMaintenances_Click(object sender, RoutedEventArgs e)
        {
            MessageBox.Show("Module Maintenances - A venir");
        }

        private void BtnRapports_Click(object sender, RoutedEventArgs e)
        {
            MessageBox.Show("Module Rapports - A venir");
        }
    }
}