<UserControl x:Class="FLEET_MANAGER.Views.CarburantTrajetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}">
	<Grid Margin="32">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<Grid Grid.Row="0" Margin="0,0,0,32">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- Titre et description -->
			<StackPanel Grid.Row="0" Style="{StaticResource PageHeaderStyle}">
				<TextBlock Style="{StaticResource PageTitleStyle}">
					Carburant et Trajets
				</TextBlock>
				<TextBlock Style="{StaticResource PageDescriptionStyle}">
					Gestion des ravitaillements et trajets de vos véhicules
				</TextBlock>
			</StackPanel>

			<!-- Sélecteur de véhicule -->
			<Grid Grid.Row="1" Margin="0,16,0,0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="450"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<TextBlock Grid.Column="0"
						   Text="Véhicule :"
						   FontSize="14"
						   FontWeight="SemiBold"
						   Foreground="{StaticResource TextPrimaryBrush}"
						   VerticalAlignment="Center"
						   Margin="0,0,12,0"/>

				<Border Grid.Column="1"
						BorderBrush="{StaticResource BorderBrush}"
						BorderThickness="1"
						CornerRadius="8"
						Background="White">
					<ComboBox ItemsSource="{Binding Vehicules}"
							  SelectedItem="{Binding VehiculeSelectionne, Mode=TwoWay}"
							  DisplayMemberPath="DescriptionComplete"
							  Height="42"
							  FontSize="14"
							  BorderThickness="0"
							  Background="Transparent"
							  Padding="12,0"
							  Foreground="{StaticResource TextPrimaryBrush}">
						<ComboBox.Resources>
							<Style TargetType="ComboBoxItem">
								<Setter Property="Padding" Value="12,10"/>
								<Setter Property="Background" Value="Transparent"/>
								<Setter Property="FontSize" Value="14"/>
								<Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
								<Style.Triggers>
									<Trigger Property="IsHighlighted" Value="True">
										<Setter Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
									</Trigger>
									<Trigger Property="IsSelected" Value="True">
										<Setter Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
										<Setter Property="FontWeight" Value="SemiBold"/>
									</Trigger>
								</Style.Triggers>
							</Style>
						</ComboBox.Resources>
					</ComboBox>
				</Border>
			</Grid>
		</Grid>

		<!-- Message d'erreur/succès -->
		<TextBlock Grid.Row="1"
				   Text="{Binding MessageErreur}"
				   Foreground="{StaticResource DangerBrush}"
				   FontSize="13"
				   Margin="0,0,0,16"
				   VerticalAlignment="Top"
				   Visibility="{Binding MessageErreur, Converter={StaticResource BoolToVisibilityConverter}}"/>

		<!-- TabControl -->
		<TabControl Grid.Row="1" Margin="0,8,0,0" BorderThickness="0" Background="Transparent">
			<TabControl.Resources>
				<Style TargetType="TabItem">
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate TargetType="TabItem">
								<Border Name="Border"
										Background="Transparent"
										BorderThickness="0,0,0,2"
										BorderBrush="Transparent"
										Padding="20,12"
										Margin="0,0,4,0"
										Cursor="Hand">
									<ContentPresenter x:Name="ContentSite"
													  VerticalAlignment="Center"
													  HorizontalAlignment="Center"
													  ContentSource="Header"/>
								</Border>
								<ControlTemplate.Triggers>
									<Trigger Property="IsSelected" Value="True">
										<Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
										<Setter TargetName="Border" Property="Background" Value="Transparent"/>
									</Trigger>
									<Trigger Property="IsSelected" Value="False">
										<Setter TargetName="Border" Property="BorderBrush" Value="Transparent"/>
									</Trigger>
								</ControlTemplate.Triggers>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
					<Setter Property="FontSize" Value="14"/>
					<Setter Property="FontWeight" Value="SemiBold"/>
					<Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
					<Style.Triggers>
						<Trigger Property="IsSelected" Value="True">
							<Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
						</Trigger>
					</Style.Triggers>
				</Style>
			</TabControl.Resources>

			<!-- Onglet Carburant -->
			<TabItem Header="Carburant">
				<Grid Margin="0,24,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="380"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>

					<!-- Formulaire Carburant -->
					<Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,24,0">
						<ScrollViewer Style="{StaticResource ModernScrollViewerStyle}" Padding="0,0,8,0">
							<StackPanel>
								<TextBlock Style="{StaticResource SectionTitleStyle}">
									Nouveau ravitaillement
								</TextBlock>
								<TextBlock Style="{StaticResource SubtitleStyle}" Margin="0,0,0,24">
									Enregistrer un plein de carburant
								</TextBlock>

							<!-- Date -->
							<TextBlock Text="Date"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<DatePicker SelectedDate="{Binding DateSaisie}"
										Height="42"
										Margin="0,0,0,16"/>

							<!-- Quantité -->
							<TextBlock Text="Quantité (litres)"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding QuantiteLitres, UpdateSourceTrigger=PropertyChanged}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Coût total -->
							<TextBlock Text="Coût total (€)"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding CoutTotal, UpdateSourceTrigger=PropertyChanged}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Kilométrage -->
							<TextBlock Text="Kilométrage"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding KilometrageCarburant, UpdateSourceTrigger=PropertyChanged}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Notes -->
							<TextBlock Text="Notes"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="80"
									Margin="0,0,0,24">
								<TextBox Text="{Binding NotesCarburant}"
										 BorderThickness="0"
										 VerticalAlignment="Top"
										 Padding="12"
										 FontSize="14"
										 TextWrapping="Wrap"
										 AcceptsReturn="True"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

								<!-- Bouton Enregistrer -->
								<Button Command="{Binding EnregistrerCarburantCommand}"
										Style="{StaticResource PrimaryButtonStyle}"
										Height="42">
									<StackPanel Orientation="Horizontal">
										<TextBlock Text="+" FontSize="18" FontWeight="Bold" Margin="0,0,8,0"/>
										<TextBlock Text="Enregistrer le plein" FontSize="14"/>
									</StackPanel>
								</Button>
							</StackPanel>
						</ScrollViewer>
					</Border>

					<!-- Historique Carburant -->
					<Border Grid.Column="1" Style="{StaticResource CardStyle}">
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="*"/>
							</Grid.RowDefinitions>

							<TextBlock Grid.Row="0" Style="{StaticResource SectionTitleStyle}">
								Historique des pleins
							</TextBlock>

							<TextBlock Grid.Row="1" Style="{StaticResource SubtitleStyle}" Margin="0,0,0,16">
								<Run Text="{Binding Historique.Count, Mode=OneWay}"/>
								<Run Text="ravitaillements"/>
							</TextBlock>

							<DataGrid Grid.Row="2"
									  ItemsSource="{Binding Historique}"
									  AutoGenerateColumns="False"
									  IsReadOnly="True"
									  CanUserAddRows="False"
									  BorderThickness="0"
									  Background="Transparent"
									  RowBackground="White"
									  AlternatingRowBackground="{StaticResource BackgroundBrush}"
									  GridLinesVisibility="None"
									  HeadersVisibility="Column"
									  SelectionMode="Single"
									  CanUserResizeRows="False">
								<DataGrid.Resources>
									<Style TargetType="DataGridColumnHeader">
										<Setter Property="Background" Value="Transparent"/>
										<Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
										<Setter Property="FontWeight" Value="SemiBold"/>
										<Setter Property="FontSize" Value="12"/>
										<Setter Property="Padding" Value="12,8"/>
										<Setter Property="BorderThickness" Value="0,0,0,1"/>
										<Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
									</Style>
									<Style TargetType="DataGridCell">
										<Setter Property="BorderThickness" Value="0"/>
										<Setter Property="Padding" Value="12,12"/>
										<Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
										<Setter Property="FontSize" Value="13"/>
									</Style>
									<Style TargetType="DataGridRow">
										<Setter Property="Height" Value="48"/>
									</Style>
								</DataGrid.Resources>
								<DataGrid.Columns>
									<DataGridTextColumn Header="Date" Binding="{Binding DateSaisie, StringFormat=dd/MM/yyyy}" Width="100"/>
									<DataGridTextColumn Header="Litres" Binding="{Binding QuantiteLitres, StringFormat={}{0:N2}}" Width="80"/>
									<DataGridTextColumn Header="Coût (€)" Binding="{Binding CoutTotal, StringFormat={}{0:N2}}" Width="90"/>
									<DataGridTextColumn Header="Kilométrage" Binding="{Binding Kilometrage, StringFormat={}{0:N0}}" Width="110"/>
									<DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
								</DataGrid.Columns>
							</DataGrid>
						</Grid>
					</Border>
				</Grid>
			</TabItem>

			<!-- Onglet Trajets -->
			<TabItem Header="Trajets">
				<Grid Margin="0,24,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="380"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>

					<!-- Formulaire Trajet -->
					<Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,24,0">
						<ScrollViewer Style="{StaticResource ModernScrollViewerStyle}" Padding="0,0,8,0">
							<StackPanel>
								<TextBlock Style="{StaticResource SectionTitleStyle}">
									Nouveau trajet
								</TextBlock>
								<TextBlock Style="{StaticResource SubtitleStyle}" Margin="0,0,0,24">
									Enregistrer un déplacement
								</TextBlock>

							<!-- Date -->
							<TextBlock Text="Date"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<DatePicker SelectedDate="{Binding DateTrajet}"
										Height="42"
										Margin="0,0,0,16"/>

							<!-- Lieu départ -->
							<TextBlock Text="Lieu de départ"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding LieuDepart}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Lieu arrivée -->
							<TextBlock Text="Lieu d'arrivée"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding LieuArrivee}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Km départ -->
							<TextBlock Text="Kilométrage départ"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding KilometrageDepart, UpdateSourceTrigger=PropertyChanged}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Km arrivée -->
							<TextBlock Text="Kilométrage arrivée"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="42"
									Margin="0,0,0,16">
								<TextBox Text="{Binding KilometrageArrivee, UpdateSourceTrigger=PropertyChanged}"
										 BorderThickness="0"
										 VerticalAlignment="Center"
										 Padding="12,0"
										 FontSize="14"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

							<!-- Notes -->
							<TextBlock Text="Notes"
									   FontSize="13"
									   FontWeight="Medium"
									   Foreground="{StaticResource TextPrimaryBrush}"
									   Margin="0,0,0,6"/>
							<Border BorderBrush="{StaticResource BorderBrush}"
									BorderThickness="1"
									CornerRadius="8"
									Background="White"
									Height="80"
									Margin="0,0,0,24">
								<TextBox Text="{Binding NotesTrajet}"
										 BorderThickness="0"
										 VerticalAlignment="Top"
										 Padding="12"
										 FontSize="14"
										 TextWrapping="Wrap"
										 AcceptsReturn="True"
										 Foreground="{StaticResource TextPrimaryBrush}"/>
							</Border>

								<!-- Bouton Enregistrer -->
								<Button Command="{Binding EnregistrerTrajetCommand}"
										Style="{StaticResource PrimaryButtonStyle}"
										Height="42">
									<StackPanel Orientation="Horizontal">
										<TextBlock Text="+" FontSize="18" FontWeight="Bold" Margin="0,0,8,0"/>
										<TextBlock Text="Enregistrer le trajet" FontSize="14"/>
									</StackPanel>
								</Button>
							</StackPanel>
						</ScrollViewer>
					</Border>

					<!-- Historique Trajets -->
					<Border Grid.Column="1" Style="{StaticResource CardStyle}">
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="*"/>
							</Grid.RowDefinitions>

							<TextBlock Grid.Row="0" Style="{StaticResource SectionTitleStyle}">
								Historique des trajets
							</TextBlock>

							<TextBlock Grid.Row="1" Style="{StaticResource SubtitleStyle}" Margin="0,0,0,16">
								<Run Text="{Binding Trajets.Count, Mode=OneWay}"/>
								<Run Text="trajets"/>
							</TextBlock>

							<DataGrid Grid.Row="2"
									  ItemsSource="{Binding Trajets}"
									  AutoGenerateColumns="False"
									  IsReadOnly="True"
									  CanUserAddRows="False"
									  BorderThickness="0"
									  Background="Transparent"
									  RowBackground="White"
									  AlternatingRowBackground="{StaticResource BackgroundBrush}"
									  GridLinesVisibility="None"
									  HeadersVisibility="Column"
									  SelectionMode="Single"
									  CanUserResizeRows="False">
								<DataGrid.Resources>
									<Style TargetType="DataGridColumnHeader">
										<Setter Property="Background" Value="Transparent"/>
										<Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
										<Setter Property="FontWeight" Value="SemiBold"/>
										<Setter Property="FontSize" Value="12"/>
										<Setter Property="Padding" Value="12,8"/>
										<Setter Property="BorderThickness" Value="0,0,0,1"/>
										<Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
									</Style>
									<Style TargetType="DataGridCell">
										<Setter Property="BorderThickness" Value="0"/>
										<Setter Property="Padding" Value="12,12"/>
										<Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
										<Setter Property="FontSize" Value="13"/>
									</Style>
									<Style TargetType="DataGridRow">
										<Setter Property="Height" Value="48"/>
									</Style>
								</DataGrid.Resources>
								<DataGrid.Columns>
									<DataGridTextColumn Header="Date" Binding="{Binding DateTrajet, StringFormat=dd/MM/yyyy}" Width="100"/>
									<DataGridTextColumn Header="Départ" Binding="{Binding LieuDepart}" Width="120"/>
									<DataGridTextColumn Header="Arrivée" Binding="{Binding LieuArrivee}" Width="120"/>
									<DataGridTextColumn Header="Distance (km)" Binding="{Binding DistanceParcourue, StringFormat={}{0:N0}}" Width="110"/>
									<DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
								</DataGrid.Columns>
							</DataGrid>
						</Grid>
					</Border>
				</Grid>
			</TabItem>
		</TabControl>
	</Grid>
</UserControl>
