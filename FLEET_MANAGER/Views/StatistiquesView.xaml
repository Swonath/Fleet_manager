<UserControl x:Class="FLEET_MANAGER.Views.StatistiquesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:FLEET_MANAGER.Views"
             Background="{StaticResource BackgroundBrush}">
    <UserControl.Resources>
        <local:PercentageToWidthConverter x:Key="PercentageToWidthConverter"/>
    </UserControl.Resources>
    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Indicateur de chargement -->
        <Border Grid.Row="1"
                Background="#F8FAFC"
                CornerRadius="12"
                Padding="40"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{Binding EstEnChargement, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center">
                <TextBlock Text="‚è≥"
                           FontSize="48"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,16"/>
                <TextBlock Text="Calcul des statistiques..."
                           FontSize="16"
                           FontWeight="Medium"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Header -->
        <StackPanel Grid.Row="0" Style="{StaticResource PageHeaderStyle}" Margin="0,0,0,32">
            <TextBlock Style="{StaticResource PageTitleStyle}">
                Statistiques
            </TextBlock>
            <TextBlock Style="{StaticResource PageDescriptionStyle}">
                Analyse d√©taill√©e des performances de votre flotte
            </TextBlock>
        </StackPanel>

        <!-- Contenu principal -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="0,0,8,0">
            <StackPanel Margin="0,0,8,0">

                <!-- Vue d'ensemble - 4 KPI principaux -->
                <Grid Margin="0,0,0,32">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total V√©hicules -->
                    <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,12,0">
                        <StackPanel>
                            <TextBlock Text="üöó" FontSize="32" Margin="0,0,0,12"/>
                            <TextBlock Text="{Binding TotalVehicules}"
                                       FontSize="42"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource PrimaryBrush}"/>
                            <TextBlock Text="V√©hicules"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Total Trajets -->
                    <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="0,0,12,0">
                        <StackPanel>
                            <TextBlock Text="üìç" FontSize="32" Margin="0,0,0,12"/>
                            <TextBlock Text="{Binding TotalTrajets}"
                                       FontSize="42"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource InfoBrush}"/>
                            <TextBlock Text="Trajets"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Kilom√©trage Total -->
                    <Border Grid.Column="2" Style="{StaticResource CardStyle}" Margin="0,0,12,0">
                        <StackPanel>
                            <TextBlock Text="üõ£Ô∏è" FontSize="32" Margin="0,0,0,12"/>
                            <TextBlock Text="{Binding KilometrageTotalParcouru, StringFormat={}{0:N0}}"
                                       FontSize="42"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource SuccessBrush}"/>
                            <TextBlock Text="Kilom√®tres"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Co√ªt Total -->
                    <Border Grid.Column="3" Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="üí∞" FontSize="32" Margin="0,0,0,12"/>
                            <TextBlock Text="{Binding CoutTotalGlobal, StringFormat={}{0:C}}"
                                       FontSize="42"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource DangerBrush}"/>
                            <TextBlock Text="Co√ªt Total"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Statistiques de Co√ªts -->
                <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock Text="üíµ Statistiques de Co√ªts"
                                   Style="{StaticResource SectionTitleStyle}"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Co√ªt Total Carburant -->
                            <Border Grid.Column="0" Style="{StaticResource StatBoxStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding CoutTotalCarburant, StringFormat={}{0:C}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource DangerBrush}"/>
                                    <TextBlock Text="Co√ªt Total Carburant"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Co√ªt Moyen par V√©hicule -->
                            <Border Grid.Column="1" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding CoutMoyenParVehicule, StringFormat={}{0:C}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource WarningBrush}"/>
                                    <TextBlock Text="Co√ªt Moyen / V√©hicule"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Co√ªt par Kilom√®tre -->
                            <Border Grid.Column="2" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding CoutParKilometre, StringFormat={}{0:C}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource InfoBrush}"/>
                                    <TextBlock Text="Co√ªt / Kilom√®tre"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Co√ªt Mois Actuel -->
                            <Border Grid.Column="3" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding CoutMoisActuel, StringFormat={}{0:C}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource PrimaryBrush}"/>
                                    <TextBlock Text="Co√ªt Mois Actuel"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Statistiques de Consommation -->
                <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock Text="‚õΩ Statistiques de Consommation"
                                   Style="{StaticResource SectionTitleStyle}"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Consommation Moyenne -->
                            <Border Grid.Column="0" Style="{StaticResource StatBoxStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding ConsommationMoyenne, StringFormat={}{0:F2}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource SuccessBrush}"/>
                                    <TextBlock Text="L/100km Moyenne"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Litres Total -->
                            <Border Grid.Column="1" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding LitresTotal, StringFormat={}{0:N0}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource WarningBrush}"/>
                                    <TextBlock Text="Litres Consomm√©s Total"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Litres Mois Actuel -->
                            <Border Grid.Column="2" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding LitresMoisActuel, StringFormat={}{0:N0}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource InfoBrush}"/>
                                    <TextBlock Text="Litres Mois Actuel"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Statistiques d'Utilisation -->
                <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
                    <StackPanel>
                        <TextBlock Text="üìä Statistiques d'Utilisation"
                                   Style="{StaticResource SectionTitleStyle}"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Distance Moyenne par V√©hicule -->
                            <Border Grid.Column="0" Style="{StaticResource StatBoxStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding DistanceMoyenneParVehicule, StringFormat={}{0:N0}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource PrimaryBrush}"/>
                                    <TextBlock Text="km Moyen / V√©hicule"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Trajets Mois Actuel -->
                            <Border Grid.Column="1" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding TrajetsMoisActuel}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource SuccessBrush}"/>
                                    <TextBlock Text="Trajets ce Mois"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Distance Mois Actuel -->
                            <Border Grid.Column="2" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding DistanceMoisActuel, StringFormat={}{0:N0}}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource InfoBrush}"/>
                                    <TextBlock Text="km ce Mois"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Section Classements -->
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Top V√©hicules √âconomiques -->
                    <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,12,0">
                        <StackPanel>
                            <TextBlock Text="üèÜ Top 5 - V√©hicules √âconomiques"
                                       Style="{StaticResource SectionTitleStyle}"
                                       Foreground="{StaticResource SuccessBrush}"
                                       Margin="0,0,0,16"/>

                            <ItemsControl ItemsSource="{Binding TopVehiculesEconomiques}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource BackgroundBrush}"
                                                CornerRadius="8"
                                                Padding="16"
                                                Margin="0,0,0,12">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Nom}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{Binding Immatriculation}"
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               Margin="0,2,0,0"/>
                                                </StackPanel>

                                                <Border Grid.Column="1"
                                                        Background="{StaticResource SuccessLightBrush}"
                                                        CornerRadius="6"
                                                        Padding="12,6">
                                                    <TextBlock Text="{Binding ConsommationFormatee}"
                                                               FontSize="13"
                                                               FontWeight="Bold"
                                                               Foreground="{StaticResource SuccessBrush}"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Top V√©hicules Plus Utilis√©s -->
                    <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="‚≠ê Top 5 - V√©hicules Plus Utilis√©s"
                                       Style="{StaticResource SectionTitleStyle}"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       Margin="0,0,0,16"/>

                            <ItemsControl ItemsSource="{Binding TopVehiculesPlusUtilises}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource BackgroundBrush}"
                                                CornerRadius="8"
                                                Padding="16"
                                                Margin="0,0,0,12">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Nom}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{Binding Immatriculation}"
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               Margin="0,2,0,0"/>
                                                </StackPanel>

                                                <Border Grid.Column="1"
                                                        Background="{StaticResource PrimaryLightBrush}"
                                                        CornerRadius="6"
                                                        Padding="12,6">
                                                    <TextBlock Text="{Binding DistanceFormatee}"
                                                               FontSize="13"
                                                               FontWeight="Bold"
                                                               Foreground="{StaticResource PrimaryBrush}"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- R√©partitions -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- R√©partition Types de Trajet -->
                    <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,12,0">
                        <StackPanel>
                            <TextBlock Text="üìç R√©partition Types de Trajet"
                                       Style="{StaticResource SectionTitleStyle}"
                                       Margin="0,0,0,16"/>

                            <ItemsControl ItemsSource="{Binding RepartitionTypesTrajet}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,0,0,12">
                                            <Grid Margin="0,0,0,6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Categorie}"
                                                           FontSize="13"
                                                           FontWeight="Medium"
                                                           Foreground="{StaticResource TextPrimaryBrush}"/>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Valeur}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           Margin="0,0,12,0"/>

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding PourcentageFormate}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource PrimaryBrush}"/>
                                            </Grid>

                                            <Border Background="{StaticResource BackgroundBrush}"
                                                    Height="8"
                                                    CornerRadius="4">
                                                <Border Background="{StaticResource PrimaryBrush}"
                                                        HorizontalAlignment="Left"
                                                        Width="{Binding Pourcentage, Converter={StaticResource PercentageToWidthConverter}}"
                                                        CornerRadius="4"/>
                                            </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- R√©partition Types de Carburant -->
                    <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="‚õΩ R√©partition Types de Carburant"
                                       Style="{StaticResource SectionTitleStyle}"
                                       Margin="0,0,0,16"/>

                            <ItemsControl ItemsSource="{Binding RepartitionTypesCarburant}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,0,0,12">
                                            <Grid Margin="0,0,0,6">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Categorie}"
                                                           FontSize="13"
                                                           FontWeight="Medium"
                                                           Foreground="{StaticResource TextPrimaryBrush}"/>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Valeur}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           Margin="0,0,12,0"/>

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding PourcentageFormate}"
                                                           FontSize="13"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource SuccessBrush}"/>
                                            </Grid>

                                            <Border Background="{StaticResource BackgroundBrush}"
                                                    Height="8"
                                                    CornerRadius="4">
                                                <Border Background="{StaticResource SuccessBrush}"
                                                        HorizontalAlignment="Left"
                                                        Width="{Binding Pourcentage, Converter={StaticResource PercentageToWidthConverter}}"
                                                        CornerRadius="4"/>
                                            </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </Grid>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
