<UserControl x:Class="FLEET_MANAGER.Views.UtilisateurView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}">
	<Grid Margin="32">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<Grid Grid.Row="0" Margin="0,0,0,32">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- Titre et description -->
			<StackPanel Grid.Row="0" Style="{StaticResource PageHeaderStyle}">
				<TextBlock Style="{StaticResource PageTitleStyle}">
					Utilisateurs
				</TextBlock>
				<TextBlock Style="{StaticResource PageDescriptionStyle}">
					Gestion des comptes utilisateurs et des permissions
				</TextBlock>
			</StackPanel>

			<!-- Boutons d'action -->
			<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,16,0,0">
				<Button Command="{Binding ChargerCommand}"
						Style="{StaticResource PrimaryButtonStyle}"
						Height="42"
						Padding="20,0"
						Margin="0,0,12,0">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="ğŸ”„" FontSize="14" Margin="0,0,8,0"/>
						<TextBlock Text="Actualiser" FontSize="14"/>
					</StackPanel>
				</Button>

				<Button Command="{Binding Nouveau}"
						Style="{StaticResource PrimaryButtonStyle}"
						Height="42"
						Padding="20,0">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="+" FontSize="18" FontWeight="Bold" Margin="0,0,8,0"/>
						<TextBlock Text="Nouvel Utilisateur" FontSize="14"/>
					</StackPanel>
				</Button>
			</StackPanel>
		</Grid>

		<!-- Message d'erreur/succÃ¨s -->
		<TextBlock Grid.Row="1"
				   Text="{Binding MessageErreur}"
				   Foreground="{StaticResource DangerBrush}"
				   FontSize="13"
				   Margin="0,0,0,16"
				   VerticalAlignment="Top"
				   Visibility="{Binding MessageErreur, Converter={StaticResource BoolToVisibilityConverter}}"/>

		<!-- Contenu principal -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="400"/>
			</Grid.ColumnDefinitions>

			<!-- Liste des utilisateurs -->
			<Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,24,0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<TextBlock Grid.Row="0" Style="{StaticResource SectionTitleStyle}">
						Liste des Utilisateurs
					</TextBlock>

					<TextBlock Grid.Row="1" Style="{StaticResource SubtitleStyle}">
						<Run Text="{Binding Utilisateurs.Count, Mode=OneWay}"/>
						<Run Text="utilisateurs"/>
					</TextBlock>

					<!-- DataGrid -->
					<DataGrid Grid.Row="2"
							  ItemsSource="{Binding Utilisateurs}"
							  SelectedItem="{Binding UtilisateurSelectionne}"
							  AutoGenerateColumns="False"
							  CanUserAddRows="False"
							  IsReadOnly="True"
							  BorderThickness="0"
							  Background="Transparent"
							  RowBackground="White"
							  AlternatingRowBackground="{StaticResource BackgroundBrush}"
							  GridLinesVisibility="None"
							  HeadersVisibility="Column"
							  SelectionMode="Single"
							  CanUserResizeRows="False"
							  Margin="0,16,0,0">
						<DataGrid.Resources>
							<Style TargetType="DataGridColumnHeader">
								<Setter Property="Background" Value="Transparent"/>
								<Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
								<Setter Property="FontWeight" Value="SemiBold"/>
								<Setter Property="FontSize" Value="12"/>
								<Setter Property="Padding" Value="12,8"/>
								<Setter Property="BorderThickness" Value="0,0,0,1"/>
								<Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
							</Style>
							<Style TargetType="DataGridCell">
								<Setter Property="BorderThickness" Value="0"/>
								<Setter Property="Padding" Value="12,12"/>
								<Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
								<Setter Property="FontSize" Value="13"/>
							</Style>
							<Style TargetType="DataGridRow">
								<Setter Property="Height" Value="48"/>
							</Style>
						</DataGrid.Resources>
						<DataGrid.Columns>
							<DataGridTextColumn Header="Nom Utilisateur" Binding="{Binding NomUtilisateur}" Width="140"/>
							<DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="180"/>
							<DataGridTextColumn Header="Nom" Binding="{Binding Nom}" Width="120"/>
							<DataGridTextColumn Header="PrÃ©nom" Binding="{Binding Prenom}" Width="120"/>
							<DataGridTextColumn Header="RÃ´le" Binding="{Binding Role}" Width="120"/>
							<DataGridTextColumn Header="Actif" Binding="{Binding Actif}" Width="*"/>
						</DataGrid.Columns>
					</DataGrid>
				</Grid>
			</Border>

			<!-- Panneau de dÃ©tail / Formulaire -->
			<Border Grid.Column="1" Style="{StaticResource CardStyle}">
				<StackPanel>
					<TextBlock Style="{StaticResource SectionTitleStyle}">
						Formulaire Utilisateur
					</TextBlock>
					<TextBlock Style="{StaticResource SubtitleStyle}" Margin="0,0,0,24">
						CrÃ©er ou modifier un utilisateur
					</TextBlock>

					<!-- Nom Utilisateur -->
					<TextBlock Text="Nom Utilisateur"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<Border BorderBrush="{StaticResource BorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Background="White"
							Height="42"
							Margin="0,0,0,6">
						<TextBox Text="{Binding NomUtilisateur, UpdateSourceTrigger=PropertyChanged}"
								 BorderThickness="0"
								 VerticalAlignment="Center"
								 Padding="12,0"
								 FontSize="14"
								 Foreground="{StaticResource TextPrimaryBrush}"
								 IsEnabled="{Binding EstEnEdition}"/>
					</Border>
					<TextBlock Text="{Binding NomUtilisateurError}"
							   Foreground="{StaticResource DangerBrush}"
							   FontSize="11"
							   Margin="0,0,0,12"/>

					<!-- Email -->
					<TextBlock Text="Email"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<Border BorderBrush="{StaticResource BorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Background="White"
							Height="42"
							Margin="0,0,0,6">
						<TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}"
								 BorderThickness="0"
								 VerticalAlignment="Center"
								 Padding="12,0"
								 FontSize="14"
								 Foreground="{StaticResource TextPrimaryBrush}"
								 IsEnabled="{Binding EstEnEdition}"/>
					</Border>
					<TextBlock Text="{Binding EmailError}"
							   Foreground="{StaticResource DangerBrush}"
							   FontSize="11"
							   Margin="0,0,0,12"/>

					<!-- Nom -->
					<TextBlock Text="Nom"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<Border BorderBrush="{StaticResource BorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Background="White"
							Height="42"
							Margin="0,0,0,16">
						<TextBox Text="{Binding Nom, UpdateSourceTrigger=PropertyChanged}"
								 BorderThickness="0"
								 VerticalAlignment="Center"
								 Padding="12,0"
								 FontSize="14"
								 Foreground="{StaticResource TextPrimaryBrush}"
								 IsEnabled="{Binding EstEnEdition}"/>
					</Border>

					<!-- PrÃ©nom -->
					<TextBlock Text="PrÃ©nom"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<Border BorderBrush="{StaticResource BorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Background="White"
							Height="42"
							Margin="0,0,0,16">
						<TextBox Text="{Binding Prenom, UpdateSourceTrigger=PropertyChanged}"
								 BorderThickness="0"
								 VerticalAlignment="Center"
								 Padding="12,0"
								 FontSize="14"
								 Foreground="{StaticResource TextPrimaryBrush}"
								 IsEnabled="{Binding EstEnEdition}"/>
					</Border>

					<!-- Mot de Passe -->
					<TextBlock Text="Mot de Passe"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<Border BorderBrush="{StaticResource BorderBrush}"
							BorderThickness="1"
							CornerRadius="8"
							Background="White"
							Height="42"
							Margin="0,0,0,16">
						<PasswordBox x:Name="PasswordBox"
									 BorderThickness="0"
									 VerticalAlignment="Center"
									 Padding="12,0"
									 FontSize="14"
									 IsEnabled="{Binding EstEnEdition}"
									 PasswordChanged="PasswordBox_PasswordChanged"/>
					</Border>

					<!-- RÃ´le -->
					<TextBlock Text="RÃ´le"
							   FontSize="13"
							   FontWeight="Medium"
							   Foreground="{StaticResource TextPrimaryBrush}"
							   Margin="0,0,0,6"/>
					<ComboBox x:Name="ComboRole"
							  SelectedValue="{Binding RoleSelectionne, Mode=TwoWay}"
							  SelectedValuePath="Tag"
							  Height="42"
							  FontSize="14"
							  Padding="12,0"
							  Margin="0,0,0,24"
							  IsEnabled="{Binding EstEnEdition}">
						<ComboBoxItem Tag="utilisateur" Content="Utilisateur"/>
						<ComboBoxItem Tag="admin" Content="Administrateur"/>
						<ComboBoxItem Tag="super_admin" Content="Super Administrateur"/>
					</ComboBox>

					<!-- Boutons -->
					<StackPanel>
						<!-- Bouton Sauvegarder (mode Ã©dition) -->
						<Button Command="{Binding SauvegarderCommand}"
								Style="{StaticResource PrimaryButtonStyle}"
								Height="42"
								Margin="0,0,0,8"
								Visibility="{Binding EstEnEdition, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="ğŸ’¾" FontSize="14" Margin="0,0,8,0"/>
								<TextBlock Text="Sauvegarder" FontSize="14"/>
							</StackPanel>
						</Button>

						<!-- Bouton Modifier (mode lecture) -->
						<Button Command="{Binding ModifierCommand}"
								Style="{StaticResource WarningButtonStyle}"
								Height="42"
								Margin="0,0,0,8"
								Visibility="{Binding EstEnEdition, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert, FallbackValue=Collapsed}">
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="âœï¸" FontSize="14" Margin="0,0,6,0"/>
								<TextBlock Text="Modifier" FontSize="14"/>
							</StackPanel>
						</Button>

						<!-- Bouton Supprimer (mode lecture) -->
						<Button Command="{Binding SupprimerCommand}"
								Style="{StaticResource DangerButtonStyle}"
								Height="42"
								Margin="0,0,0,8"
								Visibility="{Binding EstEnEdition, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert, FallbackValue=Collapsed}">
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="ğŸ—‘ï¸" FontSize="14" Margin="0,0,6,0"/>
								<TextBlock Text="Supprimer" FontSize="14"/>
							</StackPanel>
						</Button>

						<!-- Bouton Annuler (mode Ã©dition) -->
						<Button Command="{Binding AnnulerCommand}"
								Height="42"
								Visibility="{Binding EstEnEdition, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
							<Button.Style>
								<Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
									<Setter Property="Background" Value="{StaticResource TextSecondaryBrush}"/>
									<Setter Property="Foreground" Value="White"/>
									<Setter Property="BorderThickness" Value="0"/>
									<Setter Property="Cursor" Value="Hand"/>
									<Setter Property="FontWeight" Value="SemiBold"/>
									<Setter Property="Template">
										<Setter.Value>
											<ControlTemplate TargetType="Button">
												<Border Background="{TemplateBinding Background}"
														CornerRadius="8"
														Padding="{TemplateBinding Padding}">
													<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
												</Border>
											</ControlTemplate>
										</Setter.Value>
									</Setter>
									<Style.Triggers>
										<Trigger Property="IsMouseOver" Value="True">
											<Setter Property="Opacity" Value="0.9"/>
										</Trigger>
									</Style.Triggers>
								</Style>
							</Button.Style>
							<TextBlock Text="Annuler" FontSize="14"/>
						</Button>
					</StackPanel>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</UserControl>
