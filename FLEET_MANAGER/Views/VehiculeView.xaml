<UserControl x:Class="FLEET_MANAGER.Views.VehiculeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundBrush}">
	<Grid Margin="32">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<Grid Grid.Row="0" Margin="0,0,0,32">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- Titre et description -->
			<StackPanel Grid.Row="0" Style="{StaticResource PageHeaderStyle}">
				<TextBlock Style="{StaticResource PageTitleStyle}">
					V√©hicules
				</TextBlock>
				<TextBlock Style="{StaticResource PageDescriptionStyle}">
					Gestion et suivi de vos v√©hicules
				</TextBlock>
			</StackPanel>

			<!-- Barre de recherche et bouton Ajouter -->
			<Grid Grid.Row="1" Margin="0,16,0,0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<!-- Barre de recherche -->
				<Border Grid.Column="0"
						BorderBrush="{StaticResource BorderBrush}"
						BorderThickness="1"
						CornerRadius="8"
						Background="White"
						Height="42"
						Margin="0,0,16,0">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<TextBlock Grid.Column="0"
								   Text="üîç"
								   FontSize="16"
								   VerticalAlignment="Center"
								   Margin="12,0,8,0"
								   Foreground="{StaticResource TextSecondaryBrush}"/>

						<TextBox Grid.Column="1"
								 Text="{Binding RechercheTexte, UpdateSourceTrigger=PropertyChanged}"
								 BorderThickness="0"
								 Background="Transparent"
								 VerticalAlignment="Center"
								 FontSize="14"
								 Foreground="{StaticResource TextPrimaryBrush}">
							<TextBox.Style>
								<Style TargetType="TextBox">
									<Setter Property="Template">
										<Setter.Value>
											<ControlTemplate TargetType="TextBox">
												<Grid>
													<TextBlock Text="Rechercher un v√©hicule..."
															   Foreground="{StaticResource TextSecondaryBrush}"
															   VerticalAlignment="Center"
															   Visibility="Collapsed"
															   x:Name="Placeholder"/>
													<ScrollViewer x:Name="PART_ContentHost"
																  VerticalAlignment="Center"
																  Foreground="{TemplateBinding Foreground}"/>
												</Grid>
												<ControlTemplate.Triggers>
													<Trigger Property="Text" Value="">
														<Setter TargetName="Placeholder" Property="Visibility" Value="Visible"/>
													</Trigger>
													<Trigger Property="Text" Value="{x:Null}">
														<Setter TargetName="Placeholder" Property="Visibility" Value="Visible"/>
													</Trigger>
												</ControlTemplate.Triggers>
											</ControlTemplate>
										</Setter.Value>
									</Setter>
								</Style>
							</TextBox.Style>
						</TextBox>
					</Grid>
				</Border>

				<!-- Bouton Ajouter -->
				<Button Grid.Column="1"
						Click="BtnNouveauVehicule_Click"
						Style="{StaticResource PrimaryButtonStyle}"
						Padding="20,0"
						Height="42">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="+" FontSize="18" FontWeight="Bold" Margin="0,0,8,0"/>
						<TextBlock Text="Ajouter un v√©hicule" FontSize="14"/>
					</StackPanel>
				</Button>
			</Grid>
		</Grid>

		<!-- Message d'erreur/succ√®s -->
		<TextBlock Grid.Row="1"
				   Text="{Binding MessageErreur}"
				   Foreground="{StaticResource DangerBrush}"
				   FontSize="13"
				   Margin="0,0,0,16"
				   VerticalAlignment="Top"
				   Visibility="{Binding MessageErreur, Converter={StaticResource BoolToVisibilityConverter}}"/>

		<!-- Contenu principal -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="380"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<!-- Liste des v√©hicules -->
			<Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,24,0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<!-- Titre de la liste et filtre -->
					<Grid Grid.Row="0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<TextBlock Grid.Column="0" Style="{StaticResource SectionTitleStyle}">
							Liste des V√©hicules
						</TextBlock>

						<!-- Filtre de statuts -->
						<ComboBox Grid.Column="1"
								  SelectedValue="{Binding FiltreStatut, Mode=TwoWay}"
								  SelectedValuePath="Content"
								  Width="150"
								  Height="32"
								  FontSize="12"
								  Margin="8,0,0,0">
							<ComboBoxItem Content="Tous"/>
							<ComboBoxItem Content="Disponible"/>
							<ComboBoxItem Content="En service"/>
							<ComboBoxItem Content="En maintenance"/>
						</ComboBox>
					</Grid>

					<TextBlock Grid.Row="1" Style="{StaticResource SubtitleStyle}">
						<Run Text="{Binding VehiculesFiltres.Count, Mode=OneWay}"/>
						<Run Text="v√©hicules"/>
					</TextBlock>

					<!-- Liste scrollable -->
					<ScrollViewer Grid.Row="3" Style="{StaticResource ModernScrollViewerStyle}">
						<ItemsControl ItemsSource="{Binding VehiculesFiltres}">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<!-- Carte de v√©hicule -->
									<Border Style="{StaticResource VehicleCardStyle}"
											MouseLeftButtonDown="VehicleCard_Click"
											Tag="{Binding}">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="Auto"/>
												<ColumnDefinition Width="*"/>
												<ColumnDefinition Width="Auto"/>
											</Grid.ColumnDefinitions>

											<!-- Ic√¥ne du v√©hicule -->
											<Border Grid.Column="0" Style="{StaticResource VehicleIconStyle}">
												<TextBlock Text="üöó"
														   FontSize="24"
														   HorizontalAlignment="Center"
														   VerticalAlignment="Center"/>
											</Border>

											<!-- Informations du v√©hicule -->
											<StackPanel Grid.Column="1" Margin="16,0">
												<TextBlock Text="{Binding Marque}"
														   FontSize="15"
														   FontWeight="SemiBold"
														   Foreground="{StaticResource TextPrimaryBrush}"
														   Margin="0,0,0,2"/>
												<StackPanel Orientation="Horizontal">
													<TextBlock Text="{Binding Immatriculation}"
															   FontSize="12"
															   Foreground="{StaticResource TextSecondaryBrush}"/>
													<TextBlock Text=" ‚Ä¢ " FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
													<TextBlock Text="{Binding AnneeFabrication}"
															   FontSize="12"
															   Foreground="{StaticResource TextSecondaryBrush}"/>
													<TextBlock Text=" ‚Ä¢ " FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
													<TextBlock Text="{Binding TypeCarburant}"
															   FontSize="12"
															   Foreground="{StaticResource TextSecondaryBrush}"/>
												</StackPanel>
											</StackPanel>

											<!-- Kilom√©trage et badge -->
											<StackPanel Grid.Column="2" HorizontalAlignment="Right">
												<TextBlock Text="{Binding KilomettrageActuel, StringFormat={}{0:N0} km}"
														   FontSize="13"
														   FontWeight="SemiBold"
														   Foreground="{StaticResource TextPrimaryBrush}"
														   HorizontalAlignment="Right"
														   Margin="0,0,0,6"/>

												<!-- Badge de statut -->
												<Border CornerRadius="12" Padding="8,4">
													<Border.Style>
														<Style TargetType="Border">
															<Setter Property="Background" Value="{StaticResource SuccessLightBrush}"/>
															<Style.Triggers>
																<DataTrigger Binding="{Binding Etat}" Value="En maintenance">
																	<Setter Property="Background" Value="{StaticResource WarningLightBrush}"/>
																</DataTrigger>
																<DataTrigger Binding="{Binding Etat}" Value="Disponible">
																	<Setter Property="Background" Value="{StaticResource InfoLightBrush}"/>
																</DataTrigger>
															</Style.Triggers>
														</Style>
													</Border.Style>
													<TextBlock FontSize="11" FontWeight="Medium">
														<TextBlock.Style>
															<Style TargetType="TextBlock">
																<Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
																<Setter Property="Text" Value="{Binding Etat}"/>
																<Style.Triggers>
																	<DataTrigger Binding="{Binding Etat}" Value="En maintenance">
																		<Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
																	</DataTrigger>
																	<DataTrigger Binding="{Binding Etat}" Value="Disponible">
																		<Setter Property="Foreground" Value="{StaticResource InfoBrush}"/>
																	</DataTrigger>
																</Style.Triggers>
															</Style>
														</TextBlock.Style>
													</TextBlock>
												</Border>
											</StackPanel>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</Grid>
			</Border>

			<!-- Panneau de d√©tail -->
			<ScrollViewer Grid.Column="1" Style="{StaticResource ModernScrollViewerStyle}">
				<StackPanel Visibility="{Binding VehiculeSelectionne, Converter={StaticResource BoolToVisibilityConverter}}">

					<!-- Card d'en-t√™te du v√©hicule -->
					<Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							</Grid.RowDefinitions>

							<Grid Grid.Row="0">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>

							<!-- Grande ic√¥ne -->
							<Border Grid.Column="0"
									Width="80" Height="80"
									CornerRadius="12"
									Background="{StaticResource PrimaryLightBrush}">
								<TextBlock Text="üöó" FontSize="40"
										   HorizontalAlignment="Center"
										   VerticalAlignment="Center"/>
							</Border>

							<!-- Informations principales -->
							<StackPanel Grid.Column="1" Margin="24,0" VerticalAlignment="Center">
								<TextBlock FontSize="24" FontWeight="Bold"
										   Foreground="{StaticResource TextPrimaryBrush}"
										   Margin="0,0,0,4">
									<Run Text="{Binding VehiculeSelectionne.Marque, Mode=OneWay}"/>
									<Run Text="{Binding VehiculeSelectionne.Modele, Mode=OneWay}"/>
								</TextBlock>
								<TextBlock Text="{Binding VehiculeSelectionne.Immatriculation, StringFormat=Immatriculation : {0}}"
										   FontSize="14"
										   Foreground="{StaticResource TextSecondaryBrush}"
										   Margin="0,0,0,12"/>

								<!-- Badges -->
								<StackPanel Orientation="Horizontal">
									<!-- Badge Statut -->
									<Border CornerRadius="12" Padding="10,5" Margin="0,0,8,0">
										<Border.Style>
											<Style TargetType="Border">
												<Setter Property="Background" Value="{StaticResource SuccessLightBrush}"/>
												<Style.Triggers>
													<DataTrigger Binding="{Binding VehiculeSelectionne.Etat}" Value="En maintenance">
														<Setter Property="Background" Value="{StaticResource WarningLightBrush}"/>
													</DataTrigger>
													<DataTrigger Binding="{Binding VehiculeSelectionne.Etat}" Value="Disponible">
														<Setter Property="Background" Value="{StaticResource InfoLightBrush}"/>
													</DataTrigger>
												</Style.Triggers>
											</Style>
										</Border.Style>
										<TextBlock FontSize="12" FontWeight="Medium">
											<TextBlock.Style>
												<Style TargetType="TextBlock">
													<Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
													<Setter Property="Text" Value="{Binding VehiculeSelectionne.Etat}"/>
													<Style.Triggers>
														<DataTrigger Binding="{Binding VehiculeSelectionne.Etat}" Value="En maintenance">
															<Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
														</DataTrigger>
														<DataTrigger Binding="{Binding VehiculeSelectionne.Etat}" Value="Disponible">
															<Setter Property="Foreground" Value="{StaticResource InfoBrush}"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</TextBlock.Style>
										</TextBlock>
									</Border>

									<!-- Badge Carburant -->
									<Border Style="{StaticResource InfoBadgeStyle}" Margin="0,0,8,0">
										<TextBlock Text="{Binding VehiculeSelectionne.TypeCarburant}"
												   Style="{StaticResource InfoBadgeTextStyle}"/>
									</Border>

									<!-- Badge Ann√©e -->
									<Border Style="{StaticResource LightBadgeStyle}">
										<TextBlock Text="{Binding VehiculeSelectionne.AnneeFabrication}"
												   FontSize="12" FontWeight="Medium"
												   Foreground="{StaticResource TextSecondaryBrush}"/>
									</Border>
								</StackPanel>
							</StackPanel>

							<!-- Boutons d'action -->
								<StackPanel Grid.Column="2" VerticalAlignment="Center">
									<Button Click="BtnModifier_Click"
											Style="{StaticResource WarningButtonStyle}"
											Margin="0,0,0,8"
											Height="36">
										<StackPanel Orientation="Horizontal">
											<TextBlock Text="‚úèÔ∏è" FontSize="12" Margin="0,0,6,0"/>
											<TextBlock Text="Modifier" FontSize="12"/>
										</StackPanel>
									</Button>
									<Button Command="{Binding SupprimerCommand}"
											Style="{StaticResource DangerButtonStyle}"
											Height="36">
										<StackPanel Orientation="Horizontal">
											<TextBlock Text="üóëÔ∏è" FontSize="12" Margin="0,0,6,0"/>
											<TextBlock Text="Supprimer" FontSize="12"/>
										</StackPanel>
									</Button>
								</StackPanel>
							</Grid>

							<!-- Statistiques -->
							<Grid Grid.Row="1" Margin="0,24,0,0">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<!-- Kilom√©trage actuel -->
							<Border Grid.Column="0" Style="{StaticResource StatBoxStyle}">
								<StackPanel>
									<TextBlock Style="{StaticResource StatLabelStyle}">
										Kilom√©trage actuel
									</TextBlock>
									<TextBlock Text="{Binding VehiculeSelectionne.KilomettrageActuel, StringFormat={}{0:N0} km}"
											   Style="{StaticResource StatValueStyle}"/>
								</StackPanel>
							</Border>

							<!-- Consommation moyenne (placeholder) -->
							<Border Grid.Column="1" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
								<StackPanel>
									<TextBlock Style="{StaticResource StatLabelStyle}">
										Consommation moyenne
									</TextBlock>
									<TextBlock Text="7.2 L/100km"
											   Style="{StaticResource StatValueStyle}"/>
								</StackPanel>
							</Border>

							<!-- Total carburant (placeholder) -->
							<Border Grid.Column="2" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
								<StackPanel>
									<TextBlock Style="{StaticResource StatLabelStyle}">
										Total carburant
									</TextBlock>
									<TextBlock Text="2 340 ‚Ç¨"
											   Style="{StaticResource StatValueStyle}"/>
								</StackPanel>
							</Border>

								<!-- Date d'acquisition -->
								<Border Grid.Column="3" Style="{StaticResource StatBoxStyle}" Margin="12,0,0,0">
									<StackPanel>
										<TextBlock Style="{StaticResource StatLabelStyle}">
											Date d'acquisition
										</TextBlock>
										<TextBlock Text="{Binding VehiculeSelectionne.DateAcquisition, StringFormat=dd/MM/yyyy}"
												   Style="{StaticResource StatValueStyle}"
												   FontSize="16"/>
									</StackPanel>
								</Border>
							</Grid>
						</Grid>
					</Border>

					<!-- Section √âvolution du kilom√©trage -->
					<Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
						<StackPanel>
							<TextBlock Style="{StaticResource SectionTitleStyle}">
								√âvolution du kilom√©trage
							</TextBlock>
							<TextBlock Style="{StaticResource SubtitleStyle}" Margin="0,0,0,16">
								Bas√© sur les pleins et trajets enregistr√©s
							</TextBlock>

							<!-- Placeholder pour le graphique -->
							<Border Height="200"
									Background="{StaticResource BackgroundBrush}"
									CornerRadius="8"
									Padding="20">
								<StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
									<TextBlock Text="üìà"
											   FontSize="40"
											   HorizontalAlignment="Center"
											   Margin="0,0,0,12"/>
									<TextBlock Text="Graphique d'√©volution du kilom√©trage"
											   FontSize="14"
											   Foreground="{StaticResource TextSecondaryBrush}"
											   HorizontalAlignment="Center"/>
									<TextBlock Text="(√Ä impl√©menter avec un composant de graphique)"
											   FontSize="12"
											   Foreground="{StaticResource TextSecondaryBrush}"
											   HorizontalAlignment="Center"
											   Margin="0,4,0,0"/>
								</StackPanel>
							</Border>
						</StackPanel>
					</Border>

					<!-- Section Historique -->
					<Border Style="{StaticResource CardStyle}">
						<StackPanel>
							<TextBlock Style="{StaticResource SectionTitleStyle}">
								Historique
							</TextBlock>
							<TextBlock Style="{StaticResource SubtitleStyle}" Margin="0,0,0,16">
								Pleins, trajets et modifications
							</TextBlock>

							<!-- Onglets de filtre -->
							<StackPanel Orientation="Horizontal" Margin="0,0,0,16">
								<Button Content="Tout"
										Command="{Binding ChangerFiltreHistoriqueCommand}"
										CommandParameter="Tout"
										Style="{StaticResource SecondaryButtonStyle}"
										Height="32"
										Padding="12,0"
										Margin="0,0,8,0"/>
								<Button Content="Pleins"
										Command="{Binding ChangerFiltreHistoriqueCommand}"
										CommandParameter="Pleins"
										Style="{StaticResource SecondaryButtonStyle}"
										Height="32"
										Padding="12,0"
										Margin="0,0,8,0"/>
								<Button Content="Trajets"
										Command="{Binding ChangerFiltreHistoriqueCommand}"
										CommandParameter="Trajets"
										Style="{StaticResource SecondaryButtonStyle}"
										Height="32"
										Padding="12,0"/>
							</StackPanel>

							<!-- Liste d'historique -->
							<Border Background="{StaticResource BackgroundBrush}"
									CornerRadius="8"
									Padding="20"
									Height="250">
								<ScrollViewer VerticalScrollBarVisibility="Auto">
									<ItemsControl ItemsSource="{Binding Historique}">
										<ItemsControl.ItemTemplate>
											<DataTemplate>
												<Border Background="White"
														CornerRadius="8"
														Padding="16"
														Margin="0,0,0,12">
													<Grid>
														<Grid.ColumnDefinitions>
															<ColumnDefinition Width="Auto"/>
															<ColumnDefinition Width="*"/>
														</Grid.ColumnDefinitions>

														<Border Grid.Column="0"
																Width="40" Height="40"
																CornerRadius="20"
																Margin="0,0,12,0">
															<Border.Background>
																<SolidColorBrush Color="{Binding CouleurFond}"/>
															</Border.Background>
															<TextBlock Text="{Binding Icone}"
																	   FontSize="18"
																	   HorizontalAlignment="Center"
																	   VerticalAlignment="Center"/>
														</Border>

														<StackPanel Grid.Column="1">
															<TextBlock Text="{Binding Titre}"
																	   FontSize="14"
																	   FontWeight="SemiBold"
																	   Foreground="{StaticResource TextPrimaryBrush}"/>
															<TextBlock Text="{Binding Description}"
																	   FontSize="12"
																	   Foreground="{StaticResource TextSecondaryBrush}"/>
															<TextBlock FontSize="11"
																	   Foreground="{StaticResource TextSecondaryBrush}"
																	   Margin="0,4,0,0">
																<Run Text="Kilom√©trage : "/>
																<Run Text="{Binding Kilometrage, StringFormat='{}{0:N0}'}"/>
																<Run Text=" km"/>
															</TextBlock>
														</StackPanel>
													</Grid>
												</Border>
											</DataTemplate>
										</ItemsControl.ItemTemplate>
									</ItemsControl>
								</ScrollViewer>
							</Border>
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>
		</Grid>
	</Grid>
</UserControl>
